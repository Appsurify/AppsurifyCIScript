#!/usr/bin/env python3
# Script to run OpenTest tests with Appsurify

#Requires - pip install pyyaml

# inputs
# link to test suite with all tests
# will create copy of testsuite with all tests called temp.ts
# list of tests with format testname,
# i.e. #teststorun = "Test Cases/New Test Case 2, Test Cases/New Test Case"

import csv
import os
from shutil import copyfile
import sys
from xml.etree.ElementTree import ElementTree
import yaml

testtemplatearg2 = "C:\\Github\\AppsurifyCIScript\\Archived\\ShellScript\\OpenTest\\test2.yaml"
testlistarg = "test"
#Copy xml file with all tests
# Source path 
source = testtemplatearg2

full_path = os.path.realpath(source)
  
# Destination path 
destination = os.path.join(os.path.dirname(full_path),"temp.yaml")

print(destination)
copyfile(source, destination)

#remove tests not in test list
teststorun = testlistarg
testlist = teststorun.split(',,')
data = ""

with open(source) as f:
    data = yaml.load(f, Loader=yaml.FullLoader)
    print(data)
 

#data = 
tests = []
k=0
teststring = ""
for test in testlist:
    #if k != 0:
    #    teststring = teststring + ","
    head_tail = os.path.split(test) 
    test_path = head_tail[0]
    test_name = head_tail[1]
    if test_path == "":
        test_path = "."
    print("test_path = " + test_path)
    print("test_name = " + test_name)
    testdic = {'name': test_name, 'path': test_path}
    tests.append(testdic)

print(tests)
testsdic = {'tests' : tests}
print(testsdic) 
data.update(testsdic)
print(data) 

with open(destination, 'w') as f:   
    newdata = yaml.dump(data, f)
